#!/bin/bash

set -e

function main {
  cmd="$1"; shift || :
  if [ "$cmd" == "" ]; then
    docker ps
    return
  fi
  case "$cmd" in
    clean)
      docker rm -f $(docker ps -qa)
      docker images | grep '<none>' | awk '{print $3}' | xargs docker rmi
      ;;
    l)
      docker logs -f $@
      ;;
    e)
      container="$1"; shift
      if [[ "$@" != "" ]]; then
        cmd="$@"
      else
        cmd="bash"
      fi
      docker exec -it $container $cmd
      ;;
    i)
      container="$1"
      key="$2"
      if [ "$key" == "" ]; then
        docker inspect $container | jq .
      else
        docker inspect $container | jq '.[]' | find-by-key $key
      fi
      ;;
    up|down)
      docker-compose $cmd $@
      ;;
    *)
      docker $cmd $@
      ;;
  esac
}

main $@
